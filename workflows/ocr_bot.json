{
  "name": "OCR via HTTP Request",
  "nodes": [
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {
          "download": true
        }
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.1,
      "position": [
        -480,
        160
      ],
      "id": "f4275b4f-e3f6-49be-a9da-9ea8a78d5b39",
      "name": "Telegram Trigger",
      "webhookId": "c72b0952-6693-45a9-9df9-abcddec62aeb",
      "credentials": {
        "telegramApi": {
          "id": "nGQjcVkCqx8ixoeF",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://openrouter.ai/api/v1/chat/completions",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "model",
              "value": "qwen/qwen-2-vl-72b-instruct"
            },
            {
              "name": "messages",
              "value": "={{ [\n  {\n    \"role\": \"user\",\n    \"content\": [\n      {\n        \"type\": \"text\",\n        \"text\": \"–¢—ã ‚Äî –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è OCR —Å–∏—Å—Ç–µ–º–∞. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç —Å —ç—Ç–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –∞–±—Å–æ–ª—é—Ç–Ω–æ–π —Ç–æ—á–Ω–æ—Å—Ç—å—é.\\n\\n–ü–†–ê–í–ò–õ–ê:\\n1. –í—ã–≤–µ–¥–∏ –¢–û–õ–¨–ö–û —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç. –ù–∏–∫–∞–∫–∏—Ö –≤—Å—Ç—É–ø–ª–µ–Ω–∏–π.\\n2. –°–æ—Ö—Ä–∞–Ω—è–π —Å—Ç—Ä—É–∫—Ç—É—Ä—É: –µ—Å–ª–∏ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ —Ç–∞–±–ª–∏—Ü–∞ ‚Äî —Å–¥–µ–ª–∞–π Markdown —Ç–∞–±–ª–∏—Ü—É. –ï—Å–ª–∏ —Å–ø–∏—Å–æ–∫ ‚Äî —Å–¥–µ–ª–∞–π —Å–ø–∏—Å–æ–∫.\\n3. –ù–µ –∏—Å–ø—Ä–∞–≤–ª—è–π –æ—à–∏–±–∫–∏ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–º —Ç–µ–∫—Å—Ç–µ.\\n4. –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç —Ä—É–∫–æ–ø–∏—Å–Ω—ã–π –∏ —Å–ª–æ–≤–æ –Ω–µ —Ä–∞–∑–æ–±—Ä–∞—Ç—å ‚Äî –ø–∏—à–∏ [–Ω–µ—Ä–∞–∑–±–æ—Ä—á–∏–≤–æ].\"\n      },\n      {\n        \"type\": \"image_url\",\n        \"image_url\": {\n          \"url\": \"data:image/jpeg;base64,\" + $('Telegram Trigger').first().binary.data.data\n        }\n      }\n    ]\n  }\n] }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [
        -288,
        160
      ],
      "id": "e80ff554-18fa-4445-b883-10c2f62458c5",
      "name": "–ó–∞–ø—Ä–æ—Å –∫ AI (Raw)",
      "credentials": {
        "httpHeaderAuth": {
          "id": "DrAJgNXs4ExfnxaM",
          "name": "OpenRouter Key"
        }
      },
      "onError": "continueErrorOutput"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "={{ $json.choices[0].message.content }}",
        "additionalFields": {
          "appendAttribution": false,
          "parse_mode": "Markdown"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -112,
        64
      ],
      "id": "89dd672e-42c8-4be1-b1be-95b8c0f52beb",
      "name": "–û—Ç–≤–µ—Ç –≤ Telegram",
      "webhookId": "1bcb1326-4f1f-4cff-b026-a02d7ba35118",
      "credentials": {
        "telegramApi": {
          "id": "nGQjcVkCqx8ixoeF",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').first().json.message.chat.id }}",
        "text": "={{\n(() => {\n  // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç –æ—à–∏–±–∫–∏ –≤ –Ω–∏–∂–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ\n  const err = ($json.error?.message || $json.message || JSON.stringify($json)).toLowerCase();\n\n  // 1. –ï—Å–ª–∏ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∞ (429)\n  if (err.includes(\"429\") || err.includes(\"too many\")) {\n    return \"‚è≥ –ù–µ–π—Ä–æ—Å–µ—Ç—å —Å–µ–π—á–∞—Å –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–∞ (–º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤).\\n–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏ –º–∏–Ω—É—Ç—É –∏ –æ—Ç–ø—Ä–∞–≤—å —Ñ–æ—Ç–æ —Å–Ω–æ–≤–∞.\";\n  }\n\n  // 2. –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –≤–≤–æ–¥–∞ (400)\n  if (err.includes(\"400\") || err.includes(\"input required\") || err.includes(\"bad request\")) {\n    return \"üñº –ö–∞–∂–µ—Ç—Å—è, —Ç—ã –æ—Ç–ø—Ä–∞–≤–∏–ª –Ω–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—é.\\n\\n–ë–æ—Ç —É–º–µ–µ—Ç —á–∏—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ –∫–∞—Ä—Ç–∏–Ω–∫–∏. –ï—Å–ª–∏ —ç—Ç–æ –¥–æ–∫—É–º–µ–Ω—Ç ‚Äî –ø–æ–ø—Ä–æ–±—É–π —Å–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–Ω—à–æ—Ç –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –µ–≥–æ –∫–∞–∫ —Ñ–æ—Ç–æ.\";\n  }\n\n  // 3. –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞\n  return \"üëæ –ü—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞.\\n\\n –í–æ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è —Ç–µ–±—è:\\n\\n\" + ($json.error?.message || $json.message || \"Unknown Error\");\n})()\n}}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -112,
        256
      ],
      "id": "25c523dc-3bbb-4099-adf6-e8fd834edf64",
      "name": "–°–æ–æ–±—â–∏—Ç—å –æ–± –æ—à–∏–±–∫–µ",
      "webhookId": "1bcb1326-4f1f-4cff-b026-a02d7ba35118",
      "credentials": {
        "telegramApi": {
          "id": "nGQjcVkCqx8ixoeF",
          "name": "Telegram account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "–ó–∞–ø—Ä–æ—Å –∫ AI (Raw)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ó–∞–ø—Ä–æ—Å –∫ AI (Raw)": {
      "main": [
        [
          {
            "node": "–û—Ç–≤–µ—Ç –≤ Telegram",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "–°–æ–æ–±—â–∏—Ç—å –æ–± –æ—à–∏–±–∫–µ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "8460db0b-b3ee-4a12-a278-3d2ee3fc283a",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "755f38e0f620aa96ae3b78fddf96b315647bf1ca4d6cdaace9258855aa7220bd"
  },
  "id": "BuI0C1qD5hs00Jqf",
  "tags": []
}